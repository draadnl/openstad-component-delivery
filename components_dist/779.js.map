{"version":3,"sources":["webpack:///./src/forms/component/image-upload.jsx"],"names":["registerPlugin","FilepondPluginImagePreview","FilepondPluginFileValidateType","FilepondPluginFileValidateSize","FilepondPluginFilePoster","OpenStadComponentImageUpload","props","name","allowMultiple","image","server","process","fetch","uploadedFiles","value","Array","isArray","forEach","src","push","source","url","options","type","file","metadata","poster","state","isValid","this","imageuploader","getFiles","serverId","addFile","removeFile","next","current","filter","setState","map","fileItem","files","self","asJson","config","as","JSON","parse","err","console","log","handleOnChange","ref","oninit","init","onprocessfile","updateUploadedFiles","updateValue","onremovefile","acceptedFileTypes","allowFileSizeValidation","allowReorder","styleItemPanelAspectRatio","maxFileSize","maxFiles","allowBrowse","imageResizeTargetWidth","imageResizeTargetHeight","imageCropAspectRatio","labelIdle","labelInvalidField","labelFileWaitingForSize","labelFileSizeNotAvailable","labelFileCountSingular","labelFileCountPlural","labelFileLoading","labelFileAdded","labelFileLoadError","labelFileRemoved","labelFileRemoveError","labelFileProcessing","labelFileProcessingComplete","labelFileProcessingAborted","labelFileProcessingError","labelFileProcessingRevertError","labelTapToCancel","labelTapToRetry","labelTapToUndo","labelButtonRemoveItem","labelButtonAbortItemLoad","labelButtonRetryItemLoad","labelButtonAbortItemProcessing","labelButtonUndoItemProcessing","labelButtonRetryItemProcessing","labelButtonProcessItem","OpenStadComponentDefaultInput"],"mappings":"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","file":"779.js","sourcesContent":["import { FilePond, registerPlugin } from \"react-filepond\";\n// TODO: dit gaat mis omdat webpack in die css iets invalids vindt\n// import \"filepond/dist/filepond.min.css\";\nimport 'filepond-polyfill';\nimport FilepondPluginImagePreview from 'filepond-plugin-image-preview';\nimport FilepondPluginFileValidateType from 'filepond-plugin-file-validate-type';\nimport FilepondPluginFileValidateSize from 'filepond-plugin-file-validate-size';\nimport FilepondPluginFilePoster from 'filepond-plugin-file-poster';\n\nimport OpenStadComponentDefaultInput from './default-input.jsx';\n\n// Register the plugins\nregisterPlugin(FilepondPluginImagePreview, FilepondPluginFileValidateType, FilepondPluginFileValidateSize, FilepondPluginFilePoster);\n\nexport default class OpenStadComponentImageUpload extends OpenStadComponentDefaultInput {\n\n  constructor(props) {\n\n    super(props, {\n      name: 'image',\n      allowMultiple: false,\n\t\t\timage: {\n        server: {\n\t\t\t\t  process: '/image',\n\t\t\t\t  fetch: '/image'\n\t\t\t  },\n\t\t\t},\n    });\n\n    var uploadedFiles = [];\n    let value = props.value || [];\n\n    if (!Array.isArray(value)) value = [value];\n    value.forEach((image) => {\n      let src = typeof image == 'object' ? image.src : image;\n      uploadedFiles.push({\n        source: { url: src },\n        options : {\n          type: 'local',\n          file: {\n            name: src,\n          },\n          metadata: {\n            poster: src,\n          }\n        }\n      })\n    });\n\n    this.state = {\n      uploadedFiles: uploadedFiles,\n    }\n\n  }\n\n  validate() {\n    let isValid = true;\n\t\tif ( this.imageuploader && this.imageuploader.getFiles ) {\n\t\t\tvar images = this.imageuploader.getFiles();\n\t\t\timages.forEach(function(image) {\n\t\t\t\tif (!image.serverId) {\n\t\t\t\t\tisValid = false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n    return isValid;\n  }\n\n  init() {\n  }\n\n  updateUploadedFiles({ addFile, removeFile, next }) {\n\t\tif ( this.imageuploader && this.imageuploader.getFiles ) {\n      let current = this.imageuploader.getFiles();\n      if (removeFile) {\n        current = current.filter(file => file.serverId != removeFile.serverId);\n      }\n      this.setState({ uploadedFiles: current.map(fileItem => fileItem.file) }, () => {\n        if (next) next(current);\n      })\n    }\n  }\n\n  updateValue(files) {\n    let self = this;\n    let value = [];\n    var asJson = self.config.as && self.config.as == 'json';\n\t\tfiles.forEach((image) => {\n\t\t\ttry {\n\t\t\t\tvar serverId = typeof image.serverId == 'string' ? JSON.parse(image.serverId) : image.serverId;\n\t\t\t\tvalue.push( asJson ? { \"src\": serverId.url } : serverId.url  )\n\t\t\t} catch(err) { console.log(err) }\n\t\t});\n    self.handleOnChange({name: self.config.name, value})\n  }\n\n  render() {\n    let self = this;\n\n    return (\n    <FilePond\n\n      ref={ref => (this.imageuploader = ref)}\n      files={this.state.uploadedFiles}\n\n      oninit={self.init}\n      onprocessfile={( err, file ) => self.updateUploadedFiles({ addFile: file, next: files => self.updateValue(files) })}\n      onremovefile={( err, file ) => self.updateUploadedFiles({ removeFile: file, next: files => self.updateValue(files) })}\n        \n      name=\"image\"\n      server={this.config.image.server.process}\n      allowMultiple={this.config.allowMultiple}\n      \n      // todo: maak dit allemaal configurabel\n\t\t\tacceptedFileTypes={['image/*']}\n\t\t\tallowFileSizeValidation=\"true\"\n      allowReorder={true}\n      styleItemPanelAspectRatio=\"1\"\n\t\t\tmaxFileSize=\"8mb\"\n\t\t\tmaxFiles=\"5\"\n\t\t\tallowBrowse=\"true\"\n\t\t\timageResizeTargetWidth=\"80\"\n\t\t\timageResizeTargetHeight=\"80\"\n\t\t\timageCropAspectRatio=\"16:9\"\n\t\t\tlabelIdle=\"Sleep afbeelding(en) naar deze plek of <span class='filepond--label-action'>KLIK HIER</span>\"\n\t\t\tlabelInvalidField=\"Field contains invalid files\"\n\t\t\tlabelFileWaitingForSize=\"Wachtend op grootte\"\n\t\t\tlabelFileSizeNotAvailable=\"Grootte niet beschikbaar\"\n\t\t\tlabelFileCountSingular=\"Bestand in lijst\"\n\t\t\tlabelFileCountPlural=\"Bestanden in lijst\"\n\t\t\tlabelFileLoading=\"Laden\"\n\t\t\tlabelFileAdded=\"Toegevoegd\"\n\t\t\tlabelFileLoadError=\"Fout bij het uploaden\"\n\t\t\tlabelFileRemoved=\"Verwijderd\"\n\t\t\tlabelFileRemoveError=\"Fout bij het verwijderen\"\n\t\t\tlabelFileProcessing=\"Laden\"\n\t\t\tlabelFileProcessingComplete=\"Afbeelding geladen\"\n\t\t\tlabelFileProcessingAborted=\"Upload cancelled\"\n\t\t\tlabelFileProcessingError=\"Error during upload\"\n\t\t\tlabelFileProcessingRevertError=\"Error during revert\"\n\t\t\tlabelTapToCancel=\"tap to cancel\"\n\t\t\tlabelTapToRetry=\"tap to retry\"\n\t\t\tlabelTapToUndo=\"tap to undo\"\n\t\t\tlabelButtonRemoveItem=\"Verwijderen\"\n\t\t\tlabelButtonAbortItemLoad=\"Abort\"\n\t\t\tlabelButtonRetryItemLoad=\"Retry\"\n\t\t\tlabelButtonAbortItemProcessing=\"Verwijder\"\n\t\t\tlabelButtonUndoItemProcessing=\"Undo\"\n\t\t\tlabelButtonRetryItemProcessing=\"Retry\"\n\t\t\tlabelButtonProcessItem=\"Upload\"\n\n    />);\n\n  }\n}\n\n\n"],"sourceRoot":""}